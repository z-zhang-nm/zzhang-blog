---
title: "堆和栈的区别"
date: 2021-04-09T16:38:36+08:00
categories:
- C++
- 常见问题
tags:
- 堆和栈
keywords:
- tech
#thumbnailImage: //example.com/image.jpg
---
　　C++存储区分为全局数据区、代码区、堆区和栈区，其中全局数据区存放静态数据、全局变量和常量，代码区存放函数体的二进制代码，栈区存放函数的返回地址、形参、局部变量、返回类型等，堆区存放剩下的内存。
<!--more-->
1. 申请方式不同：栈是系统自动分配；堆是用户自行申请和释放
2. 系统响应不同：只要栈的剩余空间大于申请内存，系统就会为程序提供内存，否则报栈溢出异常；系统收到空间申请请求后会遍历一个空闲内存链表，当找到第一个空间大于所申请内存的堆结点，就会将该结点从链表删除，并将该结点内存分配给程序，后在这块内存区域的首地址记录分配大小，这是为了delete时可以删除这块内存中的全部变量，最后系统将这个内存区域多出来的部分重新加入空闲链表
3. 申请大小限制：栈是由栈顶向低地址扩展的数据结构，且是一块连续的内存区域，这表示栈顶地址和栈的最大容量是系统预先设定好的，一般是1~2M；堆是向高地址扩展的数据结构，且不是连续的内存区域，堆的大小受限于系统有效的虚拟内存
4. 申请效率不同：栈由系统自动分配，速度较快；堆由new分配，速度较慢，容易产生内存碎片
5. 存储内容不同：函数调用时，第一个进栈的是函数调用后下一条指令的地址，然后是函数的各个参数，按照从右向左的顺序入栈，然后是函数中的局部变量，静态变量是不入栈的，函数调用结束后，局部变量先出栈，然后是参数，最后栈顶指针指向函数调用后下一条指令的地址，程序由该点继续运行；堆在头部用一个字节存放堆的大小，对中具体内容由程序员安排

# 参考链接
- [C/C++堆和栈的区别](https://zhuanlan.zhihu.com/p/88151799)
- [C++ 栈和堆的区别](https://www.cnblogs.com/lxmhhy/p/3559212.html)
