---
title: "Linux文件描述符和文件指针"
date: 2021-04-25T17:17:30+08:00
categories:
- 网络IO
tags:
- 文件描述符
- 文件指针
keywords:
- tech
#thumbnailImage: //example.com/image.jpg
---
　　Linux基本哲学之一：一切皆文件
<!--more-->
一切皆文件，都可以用`open->write/read->close`的模式操作，socket就是该模式的一个实现，socket是一种特殊的文件，一些socket函数就是对其进行的打开、读写与关闭操作，它把复杂的TCP/IP协议族隐藏在socket接口后面，对用户来时，接口即全部，背后socket会组织数据使其符合指定的协议。

# 套接字描述符
描述符即句柄，一个整数，最常见的句柄为0，1，2三个，0为标准输入，1为标准输出，2为标准错误输出，对应的`FILE*`结构的表示为`stdin, stdout, stderr`。

当应用程序要创建一个socket时，操作系统就创建一个文件描述符提供给应用程序访问文件，从应用程序的角度看，文件描述符是一个整数，应用程序可以用它来读写文件。

系统为每个运行的进程维护一张单独的文件描述符表，当进程打开一个文件时，系统把一个指向此文件内部数据结构的指针写入这个表，并把指针在表中的索引值返回给调用者，应用进程只需记住这个描述符，并在以后操作该文件时使用它。

# 套接字文件数据结构
socket函数用来创建一个套接字，如下图示：
![套接字数据结构](/网络IO/文件描述符/1.jpg)

系统创建套接字后，大多数字段没有填写，使用套接字前必须调用一些方法填充这些字段。

# 文件指针
文件指针是C语言中所学习的东西，C语言当中使用的是文件指针而不是文件描述符做为I/O的句柄，文件指针指向进程用户区中的一个被称为`FILE`结构的数据结构，`FILE`结构包含一个缓冲区和一个文件描述符，件指针是对文件描述符的一种封装。
1. 方便程序员使用
2. 可以提高程序的移植性

# 文件描述符和文件指针的转换
```cpp
int fileno(FILE *stream);
FILE *fdopen(int fd, const char *mode);
```
mode表示打开方式，比如说`w`或者`r`。

# 参考
- [Linux的SOCKET编程详解](https://blog.csdn.net/hguisu/article/details/7445768)
